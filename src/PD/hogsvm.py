# -*- coding: utf-8 -*-
import numpy as np
import cv2
'''python实现的PD程序中HOG特征提取，SVM预测'''
NUM_N_ALL_BINS = 360
BIN_NUM_PER_BLOCK = 36

BLOCK_N = 2
STRIDE = 1
BIN_NUM = 9
PI = 3.14
ANGLES_IN_BIN = 20
BEGIN_TO_FAR = 30
FAR_TO_MIDDLE = 48
MIDDLE_TO_NEAR = 90
NEAR_TO_END = 280
#远距离
SCALE_ROI_F_HEIGHT = 34
SCALE_ROI_F_WIDTH = 14
CELL_F_HEIGHT = 4
CELL_F_WIDTH = 3
HOG_F_DIM = 756
#中距离
SCALE_ROI_M_HEIGHT = 66
SCALE_ROI_M_WIDTH = 26
CELL_M_HEIGHT = 8
CELL_M_WIDTH = 6
HOG_M_DIM = 756
#近距离
SCALE_ROI_N_HEIGHT = 82
SCALE_ROI_N_WIDTH = 34
CELL_N_HEIGHT = 8
CELL_N_WIDTH = 8
HOG_N_DIM = 972
hogNearThreashold = 16.751321
hogNearSVM = [ -0.887408,-1.027462,-1.243132,-1.510852,-0.138181,0.034096,1.109995,-0.072694,-0.945230,0.069581,-0.216509,-0.590386,-1.082722,1.145766,0.913226,1.263317,1.527988,0.513165,-0.485090,0.145176,0.126367,0.617021,0.121025,0.283156,0.059897,-0.194624,-0.662975,-0.378293,0.239805,-0.024244,0.953226,1.788289,-0.060652,0.124196,0.476546,-0.138227,-0.695669,0.456538,-0.078639,0.128592,-0.660659,0.428643,-0.140787,1.019077,0.440829,-0.462969,1.092313,0.578463,-0.130350,0.067739,0.102147,0.985270,1.804398,1.083015,-0.071166,0.275911,-0.018566,0.978504,0.697256,1.127906,0.502351,1.056479,0.154480,0.931096,1.671022,0.879665,0.981306,0.785479,0.417402,0.391021,0.800529,0.112627,2.036168,0.824413,1.068648,0.405998,-0.711476,-0.793031,-0.275986,0.823906,0.738606,1.306957,-0.142882,-0.590224,0.177818,0.238177,-0.680493,-0.653268,-0.941029,-0.976896,-0.485298,0.550551,0.283344,-0.061980,0.547391,1.242400,0.465118,0.466516,0.082775,1.020444,0.626739,-0.003926,0.220051,-0.183635,0.691236,-0.219419,0.162186,-0.078295,-0.765464,0.008886,-0.877982,0.718544,0.231790,0.432860,-0.033617,-0.015075,-0.557246,0.519868,0.286404,0.499733,0.868036,0.858096,-0.201190,0.573147,0.614450,0.050397,-0.057467,0.098936,-0.750501,-0.661996,-0.481875,-0.167046,0.532137,-0.143031,0.555326,-0.331669,0.174596,-0.502813,0.379305,0.213168,-0.114319,1.157707,0.081745,-0.037934,0.744374,0.398689,0.208030,1.177286,-0.813443,-0.016090,0.242869,0.550606,-0.000630,1.340933,1.210137,0.511546,0.817059,0.684137,0.561160,0.322898,0.621589,0.132153,-0.544351,0.154330,-0.109677,0.203888,-0.614056,0.437102,0.636745,0.101687,-0.103612,-0.465306,0.477733,-0.030276,0.044329,-0.626068,-0.223627,-0.202529,0.089596,0.027034,-0.631239,0.623317,1.051525,0.779227,0.705883,0.935289,-0.262310,0.445863,0.124737,-1.347199,0.770532,0.614765,-0.010996,0.820059,0.812913,-0.044739,0.194794,-0.002744,-0.442176,0.264337,1.384786,-0.063740,0.172616,0.022298,-0.054562,0.207719,0.040042,0.091940,-0.116099,0.432520,0.225677,-0.042994,0.057159,-0.779887,-0.082349,0.127184,0.412973,-0.061145,0.022481,-0.742158,1.172673,-0.318560,0.637646,-0.196552,0.408868,0.598720,-0.028524,-0.024865,-0.065399,0.709165,-0.172132,-0.130720,-0.080730,-0.177312,0.358019,0.285292,-0.153504,-0.053499,1.044421,0.225892,0.909964,0.547902,0.099045,0.150548,-0.031094,-0.065267,0.062592,-0.325234,0.432885,-0.025032,0.104960,0.497746,0.571331,-0.103097,0.626067,-0.209625,-0.417823,-0.519511,0.032573,-0.125557,-0.321762,0.247096,0.406724,-0.685866,0.022367,-0.315005,-0.280974,0.763086,0.160789,0.130855,0.011104,-0.351720,-0.391520,0.050777,-0.626106,0.130493,0.194071,-0.172687,0.337422,0.917311,-0.554469,0.908025,-0.006698,-0.138791,0.145914,-0.324032,-0.459144,-0.307401,-0.106108,0.489060,0.353788,0.193127,0.297885,0.359438,0.186505,0.473470,0.247738,-0.345835,-0.256909,0.719673,-0.155684,0.530666,-0.015492,-0.620765,-0.027332,0.210275,-0.948714,-0.450807,0.643404,0.035763,-0.042020,0.222842,0.135525,-0.399765,-0.370510,-0.558080,0.416558,0.283959,0.141945,0.212003,0.281799,-0.031889,0.378268,0.594614,-0.642898,0.362028,0.097523,-0.092594,0.060769,-0.708562,0.149576,-0.076688,0.011533,0.252915,-0.188711,0.352490,-0.357446,0.761349,0.122817,0.016204,-0.125462,0.485133,0.201290,-0.293598,-0.236741,0.104460,0.202341,0.886369,0.294436,0.805124,0.325061,-0.323271,-0.064428,-0.083454,-0.575826,0.842243,-0.023763,0.573767,0.017654,0.022129,0.258832,-0.150688,0.535498,-0.031017,0.440620,-0.281981,0.344551,-0.221090,0.427404,0.188988,-0.485118,-0.019408,-0.219982,-0.321130,-0.081923,0.173864,-0.500174,-0.371399,0.251071,-0.084985,-0.124608,-0.623098,-0.262461,0.183403,0.499668,0.101399,0.099227,0.985746,0.356958,0.146737,0.440001,0.075376,-0.564684,-0.001562,-0.323163,-0.477192,0.731311,-0.473396,-0.187369,-0.276885,0.785663,0.165510,1.106070,-0.478599,-0.407254,-0.410044,0.072229,0.016962,0.081760,1.259411,0.520417,0.312613,0.333362,0.319015,0.230047,0.136756,0.311242,0.398360,0.221688,-0.156202,0.541033,-0.133427,-0.579415,1.023227,0.505084,-0.296135,0.396093,0.019267,0.433216,0.296171,0.420400,-0.269429,-0.254936,-0.056260,0.243087,0.308888,0.528699,0.422905,0.105702,1.008381,0.458620,0.585795,0.274088,-0.037806,-0.411233,-0.143526,0.249008,-0.095672,0.049320,0.024695,-0.471193,-0.110836,0.042100,0.210434,0.408963,-0.041536,0.116639,-0.662136,0.056486,0.462729,0.118785,0.405851,0.538957,0.371658,0.534463,0.807088,0.236062,-0.133306,0.305861,0.169241,0.019416,-0.343365,-0.276888,0.120550,-0.266740,0.091026,-0.019297,0.432008,0.156344,0.141381,0.192864,0.164029,-0.302615,0.234808,-0.463012,-0.441879,0.250691,0.301440,0.110313,0.487832,-0.346544,0.426432,0.690862,0.355239,-0.134372,0.499917,-0.064314,0.356671,-0.306507,-0.360980,-0.272119,0.175018,-0.223460,-0.195680,0.322812,-0.000671,0.430331,0.312725,0.002523,-0.038170,0.259718,-0.289767,-0.411789,0.089196,0.459825,0.430866,0.350128,0.814372,0.191928,0.437764,0.506177,0.173455,1.564869,-0.199385,0.618413,0.050260,0.575482,0.662970,0.906457,0.173186,0.033479,1.861001,-0.612174,0.507534,1.145481,0.476093,0.226230,0.790328,-0.684394,-0.867423,0.036179,-0.020204,-0.178764,0.367591,-0.319526,0.011325,0.160913,-0.627543,-0.089498,-0.286308,-0.144398,-0.007562,0.482619,0.148818,0.731061,0.224906,0.245495,-0.246010,-0.052873,-0.190845,-0.058396,0.453924,0.343300,0.398333,0.696563,-0.550104,-0.082180,0.103109,0.260787,0.540414,0.313703,-0.111454,-0.051000,-0.156045,0.361116,-0.142887,0.027026,0.010748,-0.190256,0.469971,-0.365661,0.040511,-0.626719,0.244656,-0.148532,-0.109224,0.120870,-0.301591,0.230756,0.041298,0.206121,0.468518,0.109761,-0.065367,-0.449364,0.229274,-0.032257,0.244053,0.523892,0.464978,0.555004,0.364546,-0.091090,0.192775,0.062307,0.791269,0.061802,-0.767688,-0.011550,0.348445,-0.163190,0.265258,-0.034867,0.203228,-0.176526,0.250276,0.074922,0.618848,-0.524737,0.150073,-0.042935,-0.065941,-0.401913,-0.371483,0.834530,0.072594,0.795511,0.930198,-0.213942,-0.623884,-0.385793,0.302764,-0.340480,-0.153196,-0.156380,0.694026,-0.209109,0.047760,0.181170,0.312890,-0.051724,-0.040082,0.310521,0.046361,-0.572932,0.318141,0.395677,0.115672,0.536954,-0.379587,-0.401241,0.109779,-0.927718,0.163531,-0.477731,-0.731990,-0.125368,-0.253431,-0.121284,-0.714276,0.134385,-0.154042,0.257411,-0.018604,0.124347,-0.479191,-0.292762,-0.291559,0.246493,0.746485,-0.102843,1.012388,-0.157664,-0.529960,0.319332,-0.116310,0.413074,-0.212615,0.231090,0.106763,0.070413,-0.075661,0.338064,-0.191794,0.050372,-0.008668,-0.843582,-0.007322,-0.166650,0.414745,0.624191,0.288462,-0.129628,0.909049,-0.173569,0.627157,0.166228,0.124079,0.082085,0.629445,-0.087046,0.214942,-0.292780,0.286274,0.225627,0.203824,-0.201864,0.450145,0.094706,0.428666,-0.056452,-0.208304,0.346919,0.172251,0.510200,-0.113213,0.000053,-0.023267,-0.085310,0.044299,-0.093449,0.109733,0.046449,0.163983,1.157008,0.455781,0.121862,-0.173536,0.272861,-0.098726,-0.299743,0.636754,0.450843,0.082921,-0.131226,-0.114810,0.323681,-0.006082,-0.705087,0.491150,0.639518,0.109987,0.110922,0.056129,0.227319,0.040030,0.149458,0.136510,0.417668,-0.782301,0.323364,-0.579464,0.291644,-0.390868,-0.293594,0.295541,0.403697,-0.533757,0.814875,0.588940,0.064449,0.504054,-0.404498,-1.001557,0.073562,0.190688,-0.061804,-0.354109,-0.186939,1.016864,-0.018298,0.381138,0.074409,-0.575319,-0.121061,-0.652443,-0.064487,0.372969,0.440220,-0.052861,0.528001,-0.485547,0.255435,0.310490,-0.349261,0.670064,0.268334,0.493226,-0.010622,0.056218,-0.244170,-0.184578,0.708423,0.041150,0.545618,0.047289,-0.302262,0.809235,0.424397,0.301744,-0.375425,-0.482747,0.329289,0.168915,0.417260,0.481492,-0.046866,-0.392992,-0.153681,-0.361764,-0.096599,-0.071885,-0.297785,0.220578,-1.269936,0.466696,-0.075312,0.058439,0.031993,-1.218348,0.255764,-0.595471,0.710868,-0.412562,1.100482,-0.209413,0.198160,0.096733,0.192060,0.465074,0.877763,0.356062,0.208996,-0.175644,0.616638,-0.068339,-0.128686,-0.104226,-0.284433,0.597916,0.156034,0.941805,0.209845,0.341641,-0.516388,0.167481,0.404649,0.214700,0.134021,0.057104,-0.195109,0.752813,0.447883,0.206130,0.048337,-0.285490,0.025473,0.948763,1.273501,0.234160,0.409309,0.676780,-0.492543,0.668185,0.681757,-0.627839,-0.217584,0.080109,-0.105941,-0.473799,-0.382534,-0.677703,0.223056,0.826191,-0.376674,0.513365,0.282892,1.040183,0.465980,0.670656,-0.104915,-0.127210,-0.073194,0.142716,0.384237,-0.141050,-0.264582,0.083341,-1.049674,-0.868078,0.123462,0.305274,-0.335383,0.173692,-0.235247,0.181581,0.137426,0.196105,-0.081182,0.401980,-0.295324,-0.224792,-0.453290,-0.103161,0.417177,0.735020,0.804580,0.031106,-0.043919,-0.418542,0.007043,0.295354,0.285869,1.385915,0.279571,0.472706,0.105110,0.080337,0.378416,0.056313,0.594011,0.023275,0.469429,-0.371383,0.078196,0.133259,0.489015,-0.251220,-0.233222,0.142331,0.182675,0.692797,1.240532,-0.214146,0.102780,-0.139207,1.257631,-0.037207,0.716761,-0.105200,0.338514,0.519943,0.939105,0.129317,0.009430,0.414833,0.058869,0.939639,0.574170,-0.054309,0.291008,0.104115,-0.596006,0.407938,0.433166,-0.037190,0.606523,0.499367,0.714564,1.249215,0.195451,0.040277,-0.081178,-0.316803,0.370718,0.398602,1.010116,-0.199400,0.924643,0.769865,-0.369120,0.120590]
hogMiddleThreashold = 18.109326
hogMiddleSVM = [-0.503727,-1.073872,-0.722352,-0.704331,0.572773,0.188478,0.006980,-0.422461,-0.258794,-0.154078,-0.500089,-1.229522,-1.029571,0.594553,0.320027,1.149533,1.338204,0.500364,0.495907,-0.275148,-0.004878,0.556772,-0.293519,-0.663172,-0.083018,-0.333603,-0.073772,-0.829026,0.711823,0.200269,1.662827,1.416084,0.971027,1.538444,0.743771,0.086826,-1.540663,1.184292,0.318847,-0.158182,-0.090801,0.828746,0.771548,0.854864,0.125553,-0.950537,1.350169,0.981407,1.286691,0.268821,0.745116,1.469821,1.092087,0.105002,-0.630875,0.696143,-0.051037,0.422172,0.073656,1.716308,0.328337,0.978958,0.729448,0.459596,1.342919,0.721846,3.137335,0.983127,1.208644,-0.144387,1.281375,0.279467,1.975358,1.370144,0.789169,0.397197,0.388004,-0.905032,-1.595596,0.674760,0.187922,1.036068,0.236849,-1.334826,-0.140132,0.400991,-0.679403,-0.717733,-1.174221,-0.704540,-0.413694,1.049426,2.488846,-0.352004,1.925627,1.702306,-0.420099,1.100631,-0.131025,2.196895,-0.459375,-0.122013,0.688014,-0.863028,0.306485,-0.679849,-0.493333,-0.136291,-0.581135,-0.045238,-0.375169,0.806840,0.894157,-0.008437,0.031854,-0.714060,-0.165911,0.544617,0.814295,-0.414075,1.608758,0.771338,0.742755,-0.007391,-0.081253,0.488140,-0.116146,0.602517,-0.594771,0.617789,-0.511335,0.803986,0.382082,-0.441789,0.171673,-1.443557,0.294842,-0.887666,0.457784,1.038390,0.808794,1.017788,0.155470,0.044807,1.728532,1.065219,0.780091,0.657388,-0.558060,-1.074754,0.542934,0.177981,1.022092,1.712349,-0.107871,-0.583259,0.303779,-1.076168,0.103818,1.944287,0.159110,0.348884,-0.528255,0.149841,0.509570,-1.001203,-1.477227,0.010890,1.035220,0.048113,-0.019509,1.249242,-0.457622,-1.204825,0.089173,-0.559661,-0.129235,0.276446,0.439302,0.319387,-0.182731,-0.217559,0.621879,0.061202,0.925282,0.685388,0.018369,0.947225,0.231900,-2.420165,-0.986191,0.702682,-1.095342,1.413636,0.848528,0.151186,-0.566761,-0.380262,-0.476221,0.052917,1.743756,-1.165096,-0.436008,0.133727,-1.766660,0.278772,-0.017013,0.817212,0.139390,1.210319,0.509647,0.296684,0.947573,0.055899,1.212364,0.825252,0.171395,0.685667,0.617327,0.062516,2.110762,-0.977619,0.700299,-1.027436,0.117748,0.244650,0.153392,0.558020,0.347937,1.341861,-0.446400,-0.093934,-0.498921,0.150559,-0.270106,0.852085,1.119734,-0.075398,0.549207,1.399639,0.481524,0.216732,0.361370,-0.570235,0.182798,0.437257,0.647265,0.593397,0.377779,0.900199,0.639469,0.406857,1.212358,0.252140,0.085223,-0.364565,-0.461184,0.008435,-0.125500,-0.277956,0.031795,-0.538492,-0.583753,-0.238031,0.043571,-0.743968,-0.018773,1.656814,-0.062445,-0.297799,0.832284,-0.263724,-0.940000,0.447694,-0.016573,0.757215,0.975523,0.075219,0.206611,1.412332,0.676680,1.323468,0.883485,-0.575564,-0.822851,-0.219994,-0.285800,0.378251,0.505911,-0.092745,0.696870,1.070730,1.958426,0.996070,-0.009100,-0.286757,-0.356316,-1.516868,-0.310204,-0.286889,-0.435193,1.449971,-0.294043,0.129745,0.252548,0.346304,-0.771801,0.970694,0.980776,0.261710,0.079274,-0.266705,0.497179,0.150755,0.245930,2.167997,0.460127,1.288304,0.580948,0.196087,0.111421,0.184408,0.557430,-0.039121,-0.313253,0.871054,0.388468,1.028481,0.740098,-0.241655,-0.409401,-0.176163,0.030689,-0.050020,-0.685249,0.966875,-1.055233,0.693541,-0.031889,0.193305,-0.098894,0.395269,-0.719339,-0.484012,0.095599,0.008373,0.242886,1.316724,1.520513,0.051476,0.115406,0.168237,-0.206584,0.580936,1.346351,1.153603,-0.159966,1.685494,0.103364,-0.349694,0.786116,-0.320590,0.484687,-1.197760,-1.069850,-0.429943,-0.553319,-0.539310,0.281843,-0.032167,0.258868,-1.249498,-0.813682,-0.817690,-0.804695,0.857669,-0.495810,0.470930,-0.919477,0.460413,0.077611,-0.685044,0.127371,1.220573,0.958189,0.552161,-0.240929,1.794197,-0.372102,0.928121,0.128402,-0.773792,-0.728319,0.071121,-0.171142,-0.152329,0.722283,0.594479,-0.259948,0.274165,1.492198,-0.469019,-0.543698,-0.001707,0.245410,-1.845080,0.720176,-0.053753,-0.078103,1.372367,0.098169,0.663576,0.843439,0.399196,0.607779,-0.253637,0.675118,0.554639,1.557633,1.041939,-0.009491,0.236658,-0.042837,1.312371,-0.392693,1.140120,1.639829,-0.114440,0.514840,0.095188,-0.187160,-0.125645,0.403521,0.180754,0.369784,0.804083,0.124299,0.066861,-0.917024,-0.100913,-0.093185,0.243234,-0.515992,-0.787698,1.226838,-0.141892,-0.492026,-0.299408,0.082095,-0.134581,0.409813,0.199278,-0.199858,-0.058227,0.551129,1.117474,0.497795,-0.443527,-0.083893,0.421604,-0.281822,0.969462,1.460344,0.290022,0.674835,0.833652,0.631602,0.093510,0.705651,-0.000154,-0.135114,-0.317174,-0.074500,0.409408,-0.413553,-0.242628,-0.063146,-0.778801,-0.119691,-0.317862,-0.295960,-0.181611,0.245238,1.333245,-0.092840,0.050447,-1.618509,-0.307880,0.611283,0.584180,1.367018,1.006266,1.324702,0.347400,-0.025257,0.761951,0.036633,0.381512,0.225221,0.048658,-0.458797,0.858605,-0.045430,-0.367326,0.077485,-0.413438,0.056545,0.707903,0.226594,0.599413,-0.581074,0.128066,-0.042033,-0.680885,-1.290176,-1.200721,0.071524,1.096295,0.740944,0.657912,-0.043023,0.044875,0.305098,0.098337,0.280740,-0.179461,-0.423441,0.841386,0.060235,0.010671,-0.214856,0.895303,0.377548,0.238693,0.658716,-0.222662,1.182322,-1.127551,-0.264412,0.594649,-0.128842,0.684176,-0.222870,0.176814,-0.564330,-0.149942,-0.924829,-0.861206,-0.050914,0.953945,-0.484356,-0.987070,-0.377693,-0.237487,-0.247035,-0.260374,0.240435,0.198761,-0.152108,-1.125846,-0.023242,1.108652,0.452061,0.622509,0.934634,-0.024692,-0.158008,0.714967,-0.092960,0.440907,0.409945,0.013887,0.509101,-0.497444,0.555870,-0.066230,1.580558,-0.221140,-0.140814,0.252807,0.835606,0.360466,-0.373574,-0.340119,-0.119823,0.226020,-0.141870,0.637007,0.807251,0.961034,0.078742,-0.357799,-0.072917,-0.599964,-1.559416,-0.046130,0.938525,0.741348,-0.262764,0.272170,0.707491,0.446101,-0.200552,1.291975,0.067302,0.634020,0.913886,-0.300184,0.740216,0.751118,-0.152683,0.058225,-0.760833,0.185483,0.229737,1.227767,1.275343,0.938567,0.030597,-0.277754,-0.797006,-1.426517,-0.211318,-0.363008,0.506345,0.246755,0.715516,0.839961,-0.250634,0.462989,-0.214018,0.185937,1.036287,-0.258748,-1.811096,1.054472,1.362467,-0.193820,0.283150,-0.012802,-0.271939,0.807193,0.581360,0.250448,0.154976,0.376736,0.466401,-0.371923,0.608691,-1.496109,0.040532,0.622461,-0.372420,-0.185707,-0.874585,-0.518270,0.086666,0.120666,-0.342289,0.055769,-0.972984,0.874914,0.538627,0.724352,0.219241,0.005295,-0.295630,0.017893,0.470004,0.598966,-0.766991,-0.051755,-0.623153,-2.479983,0.400580,0.333958,0.232316,-0.282781,0.890813,0.976603,0.154582,-0.262686,-0.748250,0.420048,1.636206,-0.304021,0.097301,0.176903,0.770800,0.675179,0.430881,0.208157,-0.001687,-0.940191,-0.342058,-0.132799,0.388978,1.335975,0.387223,-0.737463,-0.537390,0.036572,-0.030424,0.311841,0.873232,0.075053,-1.011031,0.148309,0.142626,-0.144594,0.435223,0.389163,-0.931855,-0.075126,-0.296614,0.312816,1.528976,-0.718542,0.043811,0.160685,-0.192033,0.054871,0.074032,0.483206,1.981197,0.312050,-0.354152,-0.819953,0.091199,-0.189677,-0.794244,-0.166868,-0.056698,0.064412,0.769449,0.439595,-0.026406,-0.402798,0.199503,-0.124469,0.363021,0.079018,0.250016,0.252850,1.307750,0.391658,0.412597,-0.116212,-0.996994,0.229412,1.791754,-1.143348,1.414669,-0.002701,0.267871,0.272357]

#远距离SVM
hogFarThreashold = 12.975858
hogFarSVM = [-0.645145, -0.392813, 0.122821, -0.057293, 0.527951, 0.442877, -0.164539, -0.861994, 0.130693, -1.281354, 0.547795, 0.149360, -0.968206, 0.021339, 0.954293, 1.685071, 2.147719, 0.909593, 0.008695, 0.706157, 1.235425, -0.258205, -0.043340, -0.862699, 0.497237, 0.128415, 0.048159, -0.135941, -0.388209, 0.406169, 0.767659, 0.688641, 1.799019, 1.102042, 0.720449, 0.368285, 0.541159, 0.480517, -0.585361, 0.237010, 0.332696, -0.225722, -0.692624, -0.347922, 0.780110, 0.108179, 0.797849, 0.287192, 0.137960, 0.788366, -0.122345, -0.029230, 0.612414, -0.288970, -1.274398, 0.257244, -0.619674, -1.125068, 0.015488, -0.059007, 1.543736, 0.121963, 0.673535, 0.542580, 0.467591, 1.452631, 0.477552, -0.177475, 0.169205, 0.973997, 0.791563, 0.182023, 0.248610, 1.168930, 0.879814, 1.018424, -0.412120, -0.188469, -0.266068, 1.025578, 0.580885, 0.336290, -1.118584, -0.042665, 0.464403, 0.587518, -0.246428, -0.067551, -1.408295, -0.120840, 0.954461, 1.827158, 1.681753, 1.252952, 1.304716, 1.077997, -0.841597, 2.595500, 1.530344, 1.600133, 0.345047, -0.087581, -0.349905, -0.173589, 0.129108, -0.170832, 0.129575, 0.586692, 0.026101, 0.162890, -0.993341, 0.612658, 0.225790, 1.305733, -0.473754, -0.595635, 0.164088, 0.262192, 1.008309, 0.295529, 0.771087, 0.583641, 0.948172, 0.362843, 0.911246, 0.488219, 0.589275, 0.180152, 0.318737, 0.058226, -1.623988, -0.815789, 0.129156, -0.295648, 1.072023, -0.669459, 0.604241, -1.038694, 0.887732, 0.030137, 0.931631, 1.470991, 0.544932, 0.173463, 1.203933, 1.402825, 0.704056, 1.154571, 0.696867, -0.405012, -0.764545, 0.047562, 0.083319, -0.960410, -0.844245, -0.968868, 0.614708, 0.252871, 0.598781, 0.821199, -1.033517, -0.474877, -0.580355, 0.244642, 0.499394, -0.900908, -0.631975, -0.424677, 0.362494, 0.192451, 0.369392, -0.704082, 0.178940, 1.298574, -0.229212, -0.059244, 0.447947, 0.159433, -0.149250, 0.467971, 0.172147, 0.353178, 0.351996, 0.505949, 0.869197, 0.153145, -0.038063, 0.117245, 0.275259, -1.028718, -1.059940, 0.312113, 0.036222, 0.553249, 0.201951, 0.082571, -0.546289, -0.377978, -0.558964, 1.216750, 1.416767, 1.202479, -0.884060, -0.880373, -1.981156, 0.295371, 0.878740, 0.459873, -0.281056, 0.557646, 0.358195, -0.705401, -0.846328, -0.455602, 1.467883, 0.978454, -0.546329, 0.101171, -0.083062, 0.068439, 2.001711, 0.951478, 0.336765, -0.509480, -0.029766, 0.081163, 0.479130, 0.236605, 0.267996, 1.381677, 1.505520, 0.302680, -0.346010, -0.404912, 0.239441, 0.466048, 0.230668, 0.281236, -0.129569, -0.841264, 0.059025, -0.174488, 0.409036, 0.101990, 0.026289, 0.658765, 0.523938, -0.157792, -1.291749, 0.286547, -0.265352, 0.397630, 0.858228, -0.445832, 0.477625, 0.349294, -0.486152, -0.487690, -0.633750, -0.768072, -0.568059, 1.030063, -0.471600, -1.185279, -1.177030, 0.103331, 0.399718, 1.507831, 0.075560, -0.644805, 0.026866, -0.351660, 0.027358, 0.031560, -0.147843, 0.282266, 1.076485, 0.592817, 0.628011, 0.399776, 0.634394, 1.423039, 0.627363, 0.111259, 2.236588, -0.691293, -0.092540, 0.254837, 0.895015, 0.036612, -0.277885, 1.318358, 1.254924, 0.137265, 0.247615, 0.285906, -0.504241, -1.122354, -0.574042, 0.295377, -0.075219, 1.753328, 1.329589, 0.731139, -0.398918, -0.004498, 0.173316, -0.556936, 0.291972, -0.793938, 0.303378, 0.237175, 1.372192, 0.414875, 0.782827, 1.541731, -0.617666, 0.290487, -0.606109, 0.065135, 0.494748, -0.035095, -0.430857, 0.686095, -1.133696, 0.216227, 0.161181, 0.228067, 0.597329, 0.568621, 0.150430, -0.349045, 0.386579, -0.380368, -0.104723, -0.367232, -0.842746, 0.068268, 1.653660, 0.483950, 0.425171, 0.103199, -0.253399, -0.613483, -0.008028, 0.655561, 0.468231, 0.232295, 1.400053, -0.011678, 0.363654, -0.851926, 0.955496, 0.881717, 0.788148, -0.116507, -0.279564, -0.427081, 0.585749, -0.355615, 0.571991, 0.920101, 0.286023, -0.502559, 0.400920, -0.323038, -1.367227, -0.558019, -0.789092, -0.410693, 0.417696, -0.760155, -0.183154, -0.285745, 0.159606, 0.788837, 0.989321, 0.071528, -0.626445, -1.150656, -0.054611, -0.066125, 0.319626, 0.987177, 1.341371, -0.394790, 0.123366, -0.103703, 0.017120, 0.261354, 0.945275, 0.504042, 0.801465, 0.337885, -0.576591, 0.066014, 1.069666, -0.193424, -0.264277, 0.663902, -0.045154, -3.264061, -0.355688, -0.846722, -0.376247, -1.643149, 0.893601, 0.283651, 0.774365, 0.950068, -0.193580, 1.058233, 0.260508, 0.627266, -0.414947, -0.042599, 0.676526, 0.201865, 0.249534, 0.599504, 0.309087, 0.254262, 0.138722, 1.315451, -0.110944, -0.075631, 0.984752, 0.040862, 0.440321, -0.170095, -0.183297, 0.091174, -0.468725, 0.469536, 0.554259, -0.375580, 0.029743, 0.038811, -1.232066, 0.077767, 0.543620, -0.356399, 0.563135, -0.670396, -0.307804, 0.144146, -0.065731, 0.935333, 0.596954, 0.127948, -0.158962, 0.953017, 0.191697, 0.311648, 0.114697, 0.195519, 0.227493, -0.099020, 0.438080, -0.171772, -0.474886, 0.242632, 1.007086, 1.590583, 0.262677, 0.178593, 0.180584, 0.186346, 1.931572, 0.162089, 0.047828, 0.712242, 0.508587, 0.287903, -0.536986, -0.313615, 0.436124, 0.052577, -0.145543, -0.248316, -0.989033, -1.794518, -0.136223, 0.594928, 1.440651, 1.129551, -0.653656, 0.016737, -0.102860, -0.202063, -0.236228, 1.258449, 1.034419, 1.000064, 0.387346, 0.136280, -0.307686, 1.045724, -0.299380, -0.445952, 0.589207, 0.857454, 0.901542, 0.252382, 1.418886, -0.125780, -0.155790, 0.082684, 1.282370, -1.306562, -0.701477, -0.211318, 0.224712, -0.558210, -0.207596, 0.573897, -0.687408, 0.634056, -0.041385, 0.671217, 0.083702, 0.148568, -0.601478, -0.079857, -0.005080, -0.229964, -0.138483, 0.691021, 0.778519, -0.146193, 0.336157, 0.898967, 0.177895, -0.268890, 0.988051, 0.175340, 1.216805, -0.059686, 0.336995, 0.777072, 0.037567, -0.714573, 0.205963, -0.601424, -0.166929, -0.028732, -0.343807, -0.199006, 0.256836, 0.103920, -0.485479, 0.455481, 0.916156, -0.070822, -0.714877, -0.023726, -0.765259, -0.570473, 0.063034, 0.545479, -0.327580, 0.903207, -1.041664, 0.047216, -0.063128, -1.315217, -0.036340, 0.851521, -0.321606, -0.962568, 1.261499, -0.608310, -0.679683, -1.033048, -0.124535, -0.369283, 1.786939, 0.386771, 0.371279, -0.205677, 0.312063, 0.657144, -0.033814, 0.005224, -0.566133, -0.060425, 0.901340, 0.048553, 0.877141, 0.620598, -0.381101, -0.635460, -0.388265, 0.003733, -0.673905, 0.510709, 0.713522, 0.123599, 0.037865, 1.043192, -0.051405, 0.537437, 0.185484, 0.812291, 1.202082, 1.453381, 0.763751, 0.888007, 0.058839, 0.286327, 0.796916, 0.700609, 1.021751, 0.397757, 0.151385, 0.561242, 0.772528, 0.545039, -0.132283, -0.951677, 0.105361, -1.137215, 0.002072, 0.730382, -0.296327, 0.515598, -0.627628, 0.427064, -0.690296, 0.601845, -0.378221, 0.901533, -0.743386, -0.878882, -1.237470, 0.432222, 0.379787, 1.322353, 0.604182, 0.540024, 0.266536, -0.852423, 1.062983, -0.525861, 1.617179, -0.069061, -0.994443, 0.779871, -0.164804, -0.127866, 0.166512, -0.533291, 0.538230, -0.241136, 0.129290, 0.518528, 0.681155, -1.152964, -1.336013, 0.241945, 0.608103, 0.625594, -0.112910, 0.973917, 0.139941, 0.114056, 0.099042, 0.448696, 0.103685, 1.611236, -0.663153, 0.508942, -0.528312, -0.640057, 1.591164, 0.428215, -0.304123, 0.003430, 1.270393, -0.195417, 1.681843, -0.040508, -0.649992, 0.477349, 2.035434, 0.612412, 1.158540, -0.502452, 0.901613, 0.671911, 0.384937, 0.119936, 0.383817, -0.059901, -0.365236, 0.157692, 0.875662, 0.984592, 0.065190, -0.062465, -0.904291, -0.024161, 0.049880, 0.770453, 1.301204, 1.322303, 0.482986, -0.350582, 0.192790, 0.104831, 0.499137, 0.802273, 0.477336, -0.453468, 0.889727, 0.510028, 1.490510, 0.113806, -0.308190, 0.272813, 0.268739, -0.334821, 0.109363, 0.208062, 0.857706, 0.817446, 0.271188, -0.547600, -1.361258, -0.466159, 0.220328, 0.990026, -0.279906, 0.311793, -1.212492, 0.232348, 0.353318, 0.319814, -0.430294, -0.879931, 0.481765, 0.120753, 0.054862, 0.421796, 0.735496, 0.127532, 0.418682, 0.187325, 0.060448, -0.071205, 0.074739, -0.493719, 0.603653, 0.197004, -0.137878, 1.198102]
'''
    Description:判断m是否在l->h范围内
'''
def __between(m,l,h):
    if m >= l and m < h:
        return True
    return False
'''
    Description:计算HOG特征
    @param img:归一化之后的roi图像近距离34*82，中距离26*66，远距离14*34
    @param dim:特征维度，近距离972维，中远距离756维
    @param 
'''
def __computeHOGFeature(img,dim,img_h,img_w,cell_h,cell_w):
    img = np.reshape(img,(-1,))
    hog_feature = np.zeros(dim,dtype = float)
    img_gamma = np.zeros(SCALE_ROI_N_HEIGHT*SCALE_ROI_N_WIDTH,dtype = np.uint8)
    img_size,cell_num_h,cell_num_w = 0,0,0
    grad_x,grad_y,pixel_pass,cell_pass = 0,0,0,0
    i,k,cell_i,cell_j,pixel_i,pixel_j,step_h,step_w,bin_ = 0,0,0,0,0,0,0,0,0
    block_i,block_j,block_num_h,block_num_w = 0,0,0,0
    cell_label,hog_dim = 0,0
    grad_x_plus,magnit,angle,block_sum,block_norm = 0,0,0,0,0
    bins_all_cells = np.zeros(NUM_N_ALL_BINS+1,dtype = float)
    bins_per_block = np.zeros(BIN_NUM_PER_BLOCK+1,dtype = float)
    img_size = img_h * img_w
    cell_num_h = int((img_h - 2) / cell_h)
    cell_num_w = int((img_w - 2) / cell_w)
    block_num_h = int((cell_num_h - BLOCK_N) / STRIDE) + 1
    block_num_w = int((cell_num_w - BLOCK_N) / STRIDE) + 1
    for i in range(img_size):
        img_gamma[i] = np.sqrt(img[i])
#    img_gamma = np.sqrt(img)
    for cell_i in range(1,img_h-cell_h,cell_h):       
        for cell_j in range(1,img_w-cell_w,cell_w):
            cell_label += BIN_NUM
            step_h = cell_i + cell_h
            for pixel_i in range(cell_i,step_h):
                step_w = cell_j + cell_w
                for pixel_j in range(cell_j,step_w):
                    pixel_pass = pixel_i * img_w + pixel_j
                    grad_x = img_gamma[pixel_pass + 1] - img_gamma[pixel_pass - 1]
                    grad_y = img_gamma[pixel_pass + img_w] - img_gamma[pixel_pass - img_w]
                    grad_x_plus = grad_x + 0.00001
                    magnit = np.sqrt(grad_x * grad_x + grad_y * grad_y)
                    angle = ((np.arctan(grad_y/grad_x_plus) + (PI/2))*180/PI)

                    bin_ = int((cell_i-1)/cell_h)*BIN_NUM*cell_num_w + int(cell_j/cell_w) *BIN_NUM+ int(angle/ANGLES_IN_BIN)
                    bins_all_cells[bin_] += magnit
                    
    for block_i in range(block_num_h):
        for block_j in range(block_num_w):
            block_sum = 0.0
            for k in range(BIN_NUM):
                cell_pass = block_i * STRIDE * cell_num_w + block_j * STRIDE
                bins_per_block[0 * BIN_NUM + k] = bins_all_cells[cell_pass * BIN_NUM + k]
                bins_per_block[1 * BIN_NUM + k] = bins_all_cells[(cell_pass + 1) * BIN_NUM + k]
                bins_per_block[2 * BIN_NUM + k] = bins_all_cells[(cell_pass + cell_num_w) * BIN_NUM + k]
                bins_per_block[3 * BIN_NUM + k] = bins_all_cells[(cell_pass + cell_num_w + 1) * BIN_NUM + k]
            for i in range(BIN_NUM_PER_BLOCK):
                block_sum += bins_per_block[i] * bins_per_block[i]
            block_norm = np.sqrt(block_sum) + 0.00001
            for i in range(BIN_NUM_PER_BLOCK):
                bins_per_block[i] /= block_norm;
                hog_feature[hog_dim] = bins_per_block[i]
                hog_dim += 1
    return hog_feature
'''
    Description:计算不同距离ROI的特征
    @param hogfeature: roi hog特征
    @param sizetype: 0,1,2分别为远距离，中距离，近距离目标
    @return 1表示为行人，0表示非行人
'''
def getHOGFeature(srcImage,roi):
    x,y,w,h = roi[0],roi[1],roi[2],roi[3]
    hogfeature = None
    sizetype = 0#0,1,2分别为远距离、中距离、近距离目标
    if __between(h,BEGIN_TO_FAR, FAR_TO_MIDDLE):#远距离目标
        sizetype = 0
        resizedim = cv2.resize(srcImage[y:y+h,x:x+w],(SCALE_ROI_F_WIDTH,SCALE_ROI_F_HEIGHT),interpolation = cv2.INTER_AREA)        
        hogfeature = __computeHOGFeature(resizedim,756,SCALE_ROI_F_HEIGHT, SCALE_ROI_F_WIDTH, CELL_F_HEIGHT, CELL_F_WIDTH)
    elif __between(h,FAR_TO_MIDDLE, MIDDLE_TO_NEAR):#中距离目标
        sizetype = 1
        resizedim = cv2.resize(srcImage[y:y+h,x:x+w],(SCALE_ROI_M_WIDTH,SCALE_ROI_M_HEIGHT),interpolation = cv2.INTER_AREA)        
        hogfeature = __computeHOGFeature(resizedim,756,SCALE_ROI_M_HEIGHT, SCALE_ROI_M_WIDTH, CELL_M_HEIGHT, CELL_M_WIDTH)
    elif __between(h,MIDDLE_TO_NEAR, NEAR_TO_END):#近距离目标
        sizetype = 2
        resizedim = cv2.resize(srcImage[y:y+h,x:x+w],(SCALE_ROI_N_WIDTH,SCALE_ROI_N_HEIGHT),interpolation = cv2.INTER_AREA)   
        hogfeature = __computeHOGFeature(resizedim,972,SCALE_ROI_N_HEIGHT, SCALE_ROI_N_WIDTH, CELL_N_HEIGHT, CELL_N_WIDTH)
    else:return 0
    return hogfeature,sizetype

'''
    Description: 根据原图像预测单个roi是否是行人
    @param srcImage:512*300单通道图像
    @param roi:单个roi[x,y,w,h]
'''
def svmPredict(srcImage,roi):
    hogfeature,sizetype = getHOGFeature(srcImage,roi)
    sumscore = 0
    if sizetype == 0:#远距离目标
        hogFarData = np.array(hogFarSVM)
        sumscore = sum(hogFarData*hogfeature)
#        sumscore -= 12
        sumscore -= hogFarThreashold
    elif sizetype == 1:#中距离目标
        hogMiddleData = np.array(hogMiddleSVM)
        sumscore = sum(hogMiddleData*hogfeature)
#        sumscore -= 12
        sumscore -= hogMiddleThreashold
    elif sizetype == 2:#近距离目标
        hogNearData = np.array(hogNearSVM)
        sumscore = sum(hogNearData*hogfeature)
#        sumscore -= 12
        sumscore -= hogNearThreashold
    if sumscore > 0:return 1
    return 0
    
                    
    